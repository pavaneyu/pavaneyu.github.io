<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-我的spring笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/13/%E6%88%91%E7%9A%84spring%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2022-02-13T11:21:07.460Z" itemprop="datePublished">2022-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[toc]</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>IOC  控制反转  :即把创建对象的过程交给框架，也就是指将对象的创建、对象的存储、对象的管理交给了Spring容器<br> 原理:xml解析,工厂模式,反射</p>
<p>AOP面向切面:不修改源代码进行内容增强 </p>
<h1 id="IOC-创建Bean"><a href="#IOC-创建Bean" class="headerlink" title="IOC 创建Bean"></a>IOC 创建Bean</h1><h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p><a target="_blank" rel="noopener" href="https://repo.spring.io/ui/native/release/org/springframework/spring">https://repo.spring.io/ui/native/release/org/springframework/spring</a> 下载<br><a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-logging/download_logging.cgi">https://commons.apache.org/proper/commons-logging/download_logging.cgi</a>  </p>
<p>导入5个包<br>xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>, User.class); <span class="comment">//xml对象名称和类型</span></span><br></pre></td></tr></table></figure>
<p>xmlBean里用setter方法设置属性值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> &lt;property name=&quot;name&quot; value=&quot;Ouyang&quot;&gt;&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property name=&quot;name&quot;&gt;</span><br><span class="line">            &lt;null&gt;&lt;/null&gt;   设为null</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">         &lt;property name=&quot;name&quot;&gt;</span><br><span class="line">            &lt;value&gt;&lt;![CDATA[&lt;&lt;Hello&gt;&gt;]]&gt;&lt;/value&gt;  设置特殊值 或者用转义</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">      property内部可以再嵌套一个bean  表示 属性是个类</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;property name=&quot;likes&quot;&gt;</span><br><span class="line">        &lt;array&gt;                                       设置数组属性</span><br><span class="line">            &lt;value&gt;吃饭&lt;/value&gt;</span><br><span class="line">            &lt;value&gt;睡觉&lt;/value&gt;</span><br><span class="line">        &lt;/array&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">       </span><br><span class="line">        &lt;property name=&quot;map&quot;&gt;         设置map属性</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=&quot;A&quot; value=&quot;B&quot;&gt;&lt;/entry&gt;</span><br><span class="line">                &lt;entry key=&quot;C&quot; value=&quot;D&quot;&gt; &lt;/entry&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">       &lt;property name=&quot;list&quot;&gt;    </span><br><span class="line">            &lt;list&gt;                  设置list&lt;User&gt;属性,先在外层新建好几个Userbean对象</span><br><span class="line">                &lt;ref bean=&quot;user1&quot;/&gt;</span><br><span class="line">                &lt;ref bean=&quot;user2&quot;/&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;bean id=&quot;user2&quot; class=&quot;com.ouyang.User&quot;&gt;   </span><br><span class="line">&lt;!--        对象名            对象类型--&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;lwj&quot;/&gt;  </span><br><span class="line">&lt;!--        属性名              属性值--&gt;</span><br><span class="line">  </span><br><span class="line">  不在list里面对元素赋值 先赋值好再直接引用行不行?</span><br><span class="line">        &lt;property name=&quot;list&quot; ref=&quot;userList&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;util:list id=&quot;userList&quot;&gt;</span><br><span class="line">        &lt;bean id=&quot;user3&quot; class=&quot;com.ouyang.User&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;username&quot; value=&quot;aa&quot;/&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">        &lt;bean id=&quot;user4&quot; class=&quot;com.ouyang.User&quot;&gt;</span><br><span class="line">            &lt;property name=&quot;username&quot; value=&quot;bb&quot;/&gt;</span><br><span class="line">        &lt;/bean&gt;</span><br><span class="line">    &lt;/util:list&gt;</span><br></pre></td></tr></table></figure>
<h3 id="xml里用有参构造器设置属性值"><a href="#xml里用有参构造器设置属性值" class="headerlink" title="xml里用有参构造器设置属性值"></a>xml里用有参构造器设置属性值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;constructor-arg name=&quot;name&quot; value=&quot;Liu&quot;&gt;&lt;/constructor-arg&gt;xml注入集合属性</span><br></pre></td></tr></table></figure>
<h3 id="工厂bean对象"><a href="#工厂bean对象" class="headerlink" title="工厂bean对象:"></a>工厂bean对象:</h3><p> xml定义的factorybean接口实现类型(真正的返回类型是方法里面)<br> 可以与java里返回的对象类型不一样<br>在java代码里,从文件找,竟然找到一个工厂bean ,那就找工厂的产品 !</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;myFactoryBean&quot; class=&quot;com.ouyang.myFactoryBean&quot;&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class myFactoryBean implements FactoryBean&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public User getObject() throws Exception &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(&quot;oii&quot;);</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(&quot;com/ouyang/factoryBean.xml&quot;);</span><br><span class="line">User user = context.getBean(&quot;myFactoryBean&quot;, User.class);</span><br></pre></td></tr></table></figure>
<p><strong>默认bean是singleton,单例,加载xml时自动创建singleton</strong><br> bean属性     scope&#x3D;”prototype”  设置bean为原型  可以有多个对象 ,getBean()才会创建对象</p>
<h2 id="bean生命周期"><a href="#bean生命周期" class="headerlink" title="bean生命周期"></a><strong>bean生命周期</strong></h2><p>1.xml构造器创建实例<br>2.xmlsetter设置属性(包括引用其他bean的属性)<br>3.配置初始化方法  bean属性 init-method&#x3D;””<br>4.getBean获取并使用bean<br>5.配置销毁bean方法  bean属性 destroy-method&#x3D;”getObject”  context.close()</p>
<h2 id="xml中为所有bean添加后置处理器-初始化之前和之后"><a href="#xml中为所有bean添加后置处理器-初始化之前和之后" class="headerlink" title="xml中为所有bean添加后置处理器(初始化之前和之后)"></a><strong>xml中为所有bean添加后置处理器(初始化之前和之后)</strong></h2><p><code>&lt;bean id=&quot;myBeanPost&quot; class=&quot;com.ouyang.myBeanPost&quot;/&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">实现类</span><br><span class="line">public class myBeanPost implements BeanPostProcessor &#123;</span><br><span class="line">    @Nullable</span><br><span class="line">    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException &#123;</span><br><span class="line">        System.out.println(&quot;初始化之前调用方法&quot;);</span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123;</span><br><span class="line">        System.out.println(&quot;初始化之后调用方法&quot;);</span><br><span class="line">        return bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="xml自动根据外部bean配置类对象属性-很少用-往往基于注解注入属性"><a href="#xml自动根据外部bean配置类对象属性-很少用-往往基于注解注入属性" class="headerlink" title="xml自动根据外部bean配置类对象属性 (很少用   ,往往基于注解注入属性)"></a><strong>xml自动根据外部bean配置类对象属性</strong> (很少用   ,往往基于注解注入属性)</h2><p>bea  n 属性 autowire&#x3D;”byName”    根据外部bean id 配置这个bean中同名属性<br>bean 属性 autowire&#x3D;”byType  “    根据外部bean 类 配置这个bean中同类属性<br>第二种只能有一种外部bean</p>
<h2 id="xml引入外部文件"><a href="#xml引入外部文件" class="headerlink" title="xml引入外部文件"></a><strong>xml引入外部文件</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:property-placeholder location=&quot;classpath:com/ouyang/jdbc.properties&quot;/&gt;   src目录下</span><br><span class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;com.ouyang.User&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;username&quot; value=&quot;$&#123;userName&#125;&quot;/&gt;   key值</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h2 id="注解Bean管理"><a href="#注解Bean管理" class="headerlink" title="注解Bean管理"></a>注解Bean管理</h2><h3 id="注解创建Bean对象"><a href="#注解创建Bean对象" class="headerlink" title="注解创建Bean对象"></a><strong>注解创建Bean对象</strong></h3><p>1.springAOP依赖和Annotation依赖<br>2.xml里面或者配置类开启需要组件扫描 的包  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;com.ouyang&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>3.需要创建对象的类上写注解         来创建对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Component(value = &quot;user&quot;) //value(变量名)可以不写,默认为类名(首字母转换为小写)</span><br></pre></td></tr></table></figure>
<p>4.context.getBean(变量名,bean类型.class)<br> <strong>注意如果创建Bean时注解不设置变量名,则id为首字母小写后的类名</strong></p>
<p>补充:组件扫描自定义规则 ,比如只扫描Component注解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;com.ouyang&quot; use-default-filters=&quot;false&quot;&gt;</span><br><span class="line">    &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Component&quot;/&gt;</span><br><span class="line">&lt;/context:component-scan&gt;</span><br></pre></td></tr></table></figure>

<h3 id="注解设置属性"><a href="#注解设置属性" class="headerlink" title="注解设置属性"></a><strong>注解设置属性</strong></h3><p>1.把A的某个属性设置成B,需要创建AB的Bean,两个类上面都要加注解<br>  在service类上写@Service   在Dao类 写@Repository</p>
<p>2.在需要设置属性的对象上,写注解<br>@Autowired   根据属性类型  注入对象类型<br>@Qualifier     如果要注入多个同类型bean,根据属性名称  (跟Autowired 一起)<br>@Resource   都行<br>@Value          注入普通类型   </p>
<p><strong>例如 MyService类中有个Dao类型的属性 ,用注解创建Bean对象,并设置该属性的值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;com.ouyang&quot;&#125;)</span><br><span class="line">public class config &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Repository  //</span><br><span class="line">public class Dao  &#123;</span><br><span class="line">    public void add() &#123;</span><br><span class="line">        System.out.println(&quot;dao is adding&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Service(value = &quot;myy&quot;)</span><br><span class="line">public class MyService &#123;</span><br><span class="line">//    @Autowired  //按类型注入Bean对象,</span><br><span class="line">//    @Qualifier(value = &quot;dao&quot;)//如果有多个,需要写明对象名称,需要跟 @Autowired一起使用</span><br><span class="line">    @Resource(name = &quot;dao&quot;)</span><br><span class="line">    private Dao basicBao;</span><br><span class="line"></span><br><span class="line">    @Value(value = &quot;32&quot;)</span><br><span class="line">    public int anInt;</span><br><span class="line"></span><br><span class="line">    public void add() &#123;</span><br><span class="line">        System.out.println(&quot;service add&quot;);</span><br><span class="line">        basicBao.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class AnnotationTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">      //  ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;com/ouyang/Annotation/bean2.xml&quot;);</span><br><span class="line">        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(config.class);</span><br><span class="line"></span><br><span class="line">        MyService myService = context.getBean(&quot;myy&quot;, MyService.class);</span><br><span class="line">        myService.add();</span><br><span class="line">        System.out.println(myService.anInt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="AOP从切面增强方法"><a href="#AOP从切面增强方法" class="headerlink" title="AOP从切面增强方法"></a>AOP从切面增强方法</h1><p>连接点   可以被增强的方法<br>切入点   实际被增强的方法<br>通知(增强)  增强的逻辑部分<br>   前置<br> 后置通知<br>环绕(前后置)<br>异常通知<br> finally通知<br>1.配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;com.ouyang.AOP&quot;&#125;) //如果父目录下有相关同名类,一定要细化扫描范围</span><br><span class="line">@EnableAspectJAutoProxy //有Aspect注解的类自动生成代理</span><br><span class="line">public class Config &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.需要增强的类和方法  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component(value = &quot;user&quot;)</span><br><span class="line">public class User &#123;</span><br><span class="line">    public void use() &#123;</span><br><span class="line">        System.out.println(&quot;using&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.增强类   @Aspect 表示要从切面插入的类 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">@Order(1) //如果有多个增强类对同一个方法进行插入增强,设置优先级</span><br><span class="line">public class UserProxy &#123;</span><br><span class="line">    @Pointcut(value = &quot;execution(* com.ouyang.AOP.User.use(..))&quot;)</span><br><span class="line">    public void pointCut() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Before(value = &quot;pointCut()&quot;)</span><br><span class="line">    //切入点表达式 (权限修饰+被增强类路径+被增强方法+方法参数列表)</span><br><span class="line">    public void before() &#123;</span><br><span class="line">        System.out.println(&quot;before using&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterReturning(value = &quot;pointCut()&quot;)</span><br><span class="line">    public void 返回通知() &#123;</span><br><span class="line">        System.out.println(&quot;前一个执行成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After(value = &quot;pointCut()&quot;)</span><br><span class="line">    public void 最终通知() &#123;//不管被插入的地方 有无异常都执行</span><br><span class="line">        System.out.println(&quot;finally&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @AfterThrowing(value = &quot;pointCut()&quot;)</span><br><span class="line">    public void exception() &#123;</span><br><span class="line">        System.out.println(&quot;an exception!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Around(value = &quot;pointCut()&quot;)</span><br><span class="line">    public void around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;环绕之前&quot;);</span><br><span class="line">        proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(&quot;环绕之后 &quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.使用及结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class TestAOP &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(Config.class);</span><br><span class="line">        User user = context.getBean(&quot;user&quot;, User.class);  //得到被增强的对象</span><br><span class="line">        user.use();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">环绕之前</span><br><span class="line">before using</span><br><span class="line">using</span><br><span class="line">前一个执行成功</span><br><span class="line">finally</span><br><span class="line">环绕之后 </span><br></pre></td></tr></table></figure>

<h1 id="JdbcTemplate-的使用"><a href="#JdbcTemplate-的使用" class="headerlink" title="JdbcTemplate 的使用"></a>JdbcTemplate 的使用</h1><p><strong>应用层  调用逻辑层方法<br>  逻辑指挥层 进行业务操作  只调用实现层方法<br>  具体实现层(包括数据库实现和其他实现 ) 调用API   不涉及业务逻辑<br>  抽象层规定脉络</strong></p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="特点-ACID"><a href="#特点-ACID" class="headerlink" title="特点:ACID"></a>特点:ACID</h2><p>原子性 :不可分割  atomicity<br>一致性:事务前后总量一致consistency<br>隔离性:多个事务不会互相影响 isolation<br>持久性:事务提交后,数据库里保存 durability<br>###声明式管理<br>1.xml事务管理器<br>2.xml 注解驱动<br>3.在对应类或方法上面 @Transactional</p>
<h2 id="Transactional里面的参数"><a href="#Transactional里面的参数" class="headerlink" title="@Transactional里面的参数"></a>@Transactional里面的参数</h2><p>1.propagation  传播   多事务方法直接调用,如何管理  默认required<br><img src="https://upload-images.jianshu.io/upload_images/19490681-8a509372829d34ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>2.ioslation 隔离   避免并发时多事务之间  产生的问题<br>    脏读 一个未提交的事务A读到了另一个未提交的事务B的数据<br>    不可重复读:一个未提交的事务A读到了   已经提交的事务B的修改的数据<br>    幻读:一个未提交的事务A读到了另一个未提交的事务B的提交的数据<br><img src="https://upload-images.jianshu.io/upload_images/19490681-d1e4b11529ba2b3a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>3.timeout 默认-1 不计算超时   以秒为单位<br>4.readOnly  默认false<br>5.rollBackFor  哪些异常需要回滚</p>
<h2 id="完全注解步骤"><a href="#完全注解步骤" class="headerlink" title="完全注解步骤"></a><strong>完全注解步骤</strong></h2><p>1.config类   几个Bean DataSource  jdbcTemplate   TransactionManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 2022-02-05 16:28</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages = &quot;com.ouyang.JDBCTemplate使用&quot;)</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">public class TxConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public DruidDataSource getDataSource() &#123;</span><br><span class="line">        DruidDataSource druidDataSource = new DruidDataSource();</span><br><span class="line">        druidDataSource.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        druidDataSource.setUrl(&quot;jdbc:mysql://localhost:3306/db01&quot;);</span><br><span class="line">        druidDataSource.setPassword(&quot;&quot;);</span><br><span class="line">        druidDataSource.setUsername(&quot;root&quot;);</span><br><span class="line">        return druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public JdbcTemplate getJdbcTemplate(DataSource dataSource) &#123;</span><br><span class="line">        JdbcTemplate jdbcTemplate = new JdbcTemplate();</span><br><span class="line">        jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">        return jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public DataSourceTransactionManager getDataSourceTransactionManager(DataSource dataSource) &#123;</span><br><span class="line">        DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager();</span><br><span class="line">        dataSourceTransactionManager.setDataSource(dataSource);</span><br><span class="line">        return dataSourceTransactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.业务逻辑层  开启事务   </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Service(value = &quot;accService&quot;)</span><br><span class="line">@Transactional( readOnly = false,propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ)</span><br><span class="line"></span><br><span class="line">public class AccService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AccDao accDao;</span><br><span class="line"></span><br><span class="line">    public void transMoney(String from, String to, int money) &#123;</span><br><span class="line">        accDao.addMoney(money, from);</span><br><span class="line">        //  int i = 10 / 0;</span><br><span class="line">        accDao.reduceMoney(money, to);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.抽象层  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface AccDao &#123;</span><br><span class="line">    void addMoney(int money,String name);</span><br><span class="line"></span><br><span class="line">    void reduceMoney(int money,String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.数据操作层</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Repository</span><br><span class="line">public class AccDaoImpl implements AccDao&#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addMoney(int money, String name) &#123;</span><br><span class="line">        int update = jdbcTemplate.update(&quot;update table_account set money=money-? where name=? &quot;, money, name);</span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void reduceMoney(int money, String name) &#123;</span><br><span class="line">        int update = jdbcTemplate.update(&quot;update table_account set money=money+? where name=? &quot;, money, name);</span><br><span class="line">        System.out.println(update);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.应用层<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class AccTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">//        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;com/ouyang/JDBCTemplate使用/config/Empconfig.xml&quot;);</span><br><span class="line">        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(TxConfig.class);</span><br><span class="line"></span><br><span class="line">        AccService accService = context.getBean(&quot;accService&quot;, AccService.class);</span><br><span class="line"></span><br><span class="line">        accService.transMoney(&quot;oyy&quot;,&quot;liu&quot;,100);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/13/%E6%88%91%E7%9A%84spring%E7%AC%94%E8%AE%B0/" data-id="ckzl89gzv0001xkv7d68j7t8x" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/13/hello-world/" class="article-date">
  <time class="dt-published" datetime="2022-02-13T11:15:22.548Z" itemprop="datePublished">2022-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/image-20220214093032716.png" alt="image-20220214093032716"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/13/hello-world/" data-id="ckzl89gzm0000xkv7btbnelcf" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/13/%E6%88%91%E7%9A%84spring%E7%AC%94%E8%AE%B0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/02/13/hello-world/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>